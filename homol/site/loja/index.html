<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat√°logo de Pe√ßas ‚Äî Busca & Pagina√ß√£o</title>
  <!-- Tailwind CDN (modo JIT) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config opcional
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            'soft': '0 10px 25px -10px rgba(0,0,0,0.2)'
          }
        }
      }
    }
  </script>
  <style>
    /* Foco vis√≠vel para acessibilidade */
    :focus { outline: 2px solid #2563eb; outline-offset: 2px; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-4">
      <h1 class="text-xl sm:text-2xl font-bold tracking-tight">Cat√°logo de Pe√ßas e Produtos</h1>
      <span id="totalBadge" class="ml-auto text-sm text-gray-600" aria-live="polite"></span>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Controles de busca/filtragem -->
    <section class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
      <div class="md:col-span-6">
        <label for="q" class="block text-sm font-medium text-gray-700">Buscar por nome, OEM, marca, modelo‚Ä¶</label>
        <input id="q" type="search" inputmode="search" placeholder="Ex.: pastilha dianteira Civic 2015 ou 45022-TBA-A00"
               class="mt-1 w-full rounded-xl border border-gray-300 px-4 py-2 shadow-soft focus:ring-2 focus:ring-blue-500" />
      </div>
      <div class="md:col-span-3">
        <label for="brand" class="block text-sm font-medium text-gray-700">Marca</label>
        <select id="brand" class="mt-1 w-full rounded-xl border border-gray-300 px-3 py-2 shadow-soft focus:ring-2 focus:ring-blue-500">
          <option value="">Todas</option>
        </select>
      </div>
      <div class="md:col-span-3">
        <label for="pageSize" class="block text-sm font-medium text-gray-700">Itens por p√°gina</label>
        <select id="pageSize" class="mt-1 w-full rounded-xl border border-gray-300 px-3 py-2 shadow-soft focus:ring-2 focus:ring-blue-500">
          <option>12</option>
          <option>24</option>
          <option>48</option>
        </select>
      </div>
    </section>

    <!-- Contador e status -->
    <div class="mt-4 text-sm text-gray-600" id="status" aria-live="polite"></div>

    <!-- Lista de resultados -->
    <section id="results" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></section>

    <!-- Pagina√ß√£o -->
    <nav id="pagination" class="mt-6 flex items-center justify-center gap-1" aria-label="Pagina√ß√£o"></nav>
  </main>

  <template id="cardTpl">
    <article class="rounded-2xl border border-gray-200 bg-white p-4 shadow-soft hover:shadow-lg transition-shadow">
      <div class="flex items-start justify-between gap-3">
        <h3 class="text-base font-semibold leading-tight"></h3>
        <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700"></span>
      </div>
      <dl class="mt-3 text-sm text-gray-700 space-y-1">
        <div class="flex gap-2"><dt class="font-medium min-w-20">OEM:</dt><dd class="oem"></dd></div>
        <div class="flex gap-2"><dt class="font-medium min-w-20">Aplica√ß√£o:</dt><dd class="fit"></dd></div>
        <div class="flex gap-2"><dt class="font-medium min-w-20">Sistema:</dt><dd class="system"></dd></div>
      </dl>
      <div class="mt-4 flex items-center gap-2">
        <a class="inline-flex items-center justify-center rounded-xl border border-blue-600 px-3 py-2 text-sm font-medium text-blue-700 hover:bg-blue-50 focus:ring-2 focus:ring-blue-500"
           target="_blank" rel="noopener" aria-label="Ver detalhes">Ver detalhes</a>
        <button class="ml-auto inline-flex items-center justify-center rounded-xl bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"
                type="button">Adicionar</button>
      </div>
    </article>
  </template>

  <script>
  /**
   * üîß Como usar este arquivo
   * 1) Coloque um JSON em /data/products.json com a estrutura abaixo, ou use o SAMPLE_DATA para come√ßar.
   * 2) Hospede o arquivo como uma p√°gina est√°tica (GitHub Pages, S3, etc.).
   * 3) Este componente cuida de: busca, filtro por marca, pagina√ß√£o, contadores e URLs com estado (q, brand, page, size).
   *
   * Estrutura sugerida de produto:
   * {
   *   id: "uuid-ou-sku",
   *   title: "Pastilha de Freio Dianteira",
   *   brand: "Honda",
   *   oem: "45022-TBA-A00",        // partnumber OEM
   *   manufacturer: "Nissin",      // fabricante da pe√ßa (aftermarket)
   *   system: "Freio",             // sistema: Freio, Suspens√£o, Motor, El√©trica...
   *   fit: [{ make: "Honda", model: "Civic", years: [2014,2015,2016], engine: "2.0" }],
   *   url: "/produto/45022-TBA-A00.html",
   *   price: 249.90
   * }
   */

  const SAMPLE_DATA = [
    { id: "honda-45022-tba-a00", title: "Pastilha de Freio Dianteira", brand: "Honda", oem: "45022-TBA-A00", manufacturer: "Nissin", system: "Freio", fit: [{ make: "Honda", model: "Civic", years: [2014,2015,2016], engine: "2.0" }], url: "#", price: 249.90 },
    { id: "gm-13331506", title: "Filtro de Ar", brand: "Chevrolet", oem: "13331506", manufacturer: "ACDelco", system: "Motor", fit: [{ make: "Chevrolet", model: "Onix", years: [2019,2020,2021], engine: "1.0" }], url: "#", price: 59.90 },
    { id: "ford-1780111", title: "Amortecedor Traseiro", brand: "Ford", oem: "1780111", manufacturer: "Motorcraft", system: "Suspens√£o", fit: [{ make: "Ford", model: "Ka", years: [2015,2016,2017,2018], engine: "1.0" }], url: "#", price: 199.90 },
  ];

  const state = {
    data: [],
    filtered: [],
    page: 1,
    pageSize: 12,
    q: "",
    brand: ""
  };


  
  const els = {
    q: document.getElementById('q'),
    brand: document.getElementById('brand'),
    pageSize: document.getElementById('pageSize'),
    status: document.getElementById('status'),
    totalBadge: document.getElementById('totalBadge'),
    results: document.getElementById('results'),
    pagination: document.getElementById('pagination'),
    cardTpl: document.getElementById('cardTpl')
  };

  // Le estado da URL (q, brand, page, size)
  function readURLState() {
    const u = new URL(location.href);
    state.q = u.searchParams.get('q')?.trim() || "";
    state.brand = u.searchParams.get('brand') || "";
    state.page = parseInt(u.searchParams.get('page') || '1', 10) || 1;
    state.pageSize = parseInt(u.searchParams.get('size') || '12', 10);
    els.q.value = state.q;
    els.brand.value = state.brand;
    els.pageSize.value = String(state.pageSize);
  }

  function writeURLState() {
    const u = new URL(location.href);
    const sp = u.searchParams;
    state.q ? sp.set('q', state.q) : sp.delete('q');
    state.brand ? sp.set('brand', state.brand) : sp.delete('brand');
    sp.set('page', String(state.page));
    sp.set('size', String(state.pageSize));
    history.replaceState({}, '', u);
  }

  // Debounce utilit√°rio
  function debounce(fn, ms = 300) {
    let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
  }

  function normalize(str) {
    return (str || '')
      .toString()
      .toLowerCase()
      .normalize('NFD')
      .replace(/\p{Diacritic}/gu, '');
  }

  function productText(p) {
    const fitTxt = (p.fit||[]).map(f=>`${f.make} ${f.model} ${f.years ? `(${f.years[0]}‚Äì${f.years.at(-1)})` : ''} ${f.engine||''}`.trim()).join('; ');
    return [p.title, p.brand, p.oem, p.manufacturer, p.system, fitTxt].map(normalize).join(' ');
  }

  function applyFilters() {
    const qn = normalize(state.q);
    state.filtered = state.data.filter(p => {
      const brandOK = !state.brand || p.brand === state.brand;
      if (!qn) return brandOK;
      return brandOK && productText(p).includes(qn);
    });
    state.page = 1; // reset ao filtrar
    render();
  }

  function paginate(arr, page, size) {
    const start = (page - 1) * size;
    return arr.slice(start, start + size);
  }

  function renderCounts() {
    els.totalBadge.textContent = `${state.data.length} itens no cat√°logo`;
    const showing = state.filtered.length ? Math.min(state.filtered.length, state.page * state.pageSize) : 0;
    const from = state.filtered.length ? (state.page - 1) * state.pageSize + 1 : 0;
    els.status.textContent = state.filtered.length
      ? `Mostrando ${from}‚Äì${showing} de ${state.filtered.length} resultados`
      : `Nenhum resultado. Tente outras palavras-chave.`;
  }

  function renderResults() {
    els.results.innerHTML = '';
    const pageItems = paginate(state.filtered, state.page, state.pageSize);
    const frag = document.createDocumentFragment();
    pageItems.forEach(p => {
      const node = els.cardTpl.content.cloneNode(true);
      const art = node.querySelector('article');
      node.querySelector('h3').textContent = p.title;
      node.querySelector('span').textContent = p.brand;
      node.querySelector('.oem').textContent = p.oem || '-';
      node.querySelector('.system').textContent = p.system || '-';
      const fitTxt = (p.fit||[]).map(f=>`${f.make} ${f.model} ${f.years ? `(${f.years[0]}‚Äì${f.years.at(-1)})` : ''} ${f.engine||''}`.trim()).join('; ');
      node.querySelector('.fit').textContent = fitTxt || '-';
      const a = node.querySelector('a');
      a.href = p.url || '#';
      a.setAttribute('aria-label', `Ver detalhes de ${p.title}`);
      const btn = node.querySelector('button');
      btn.addEventListener('click', () => {
        alert(`Adicionar ao carrinho: ${p.title} (OEM ${p.oem || '-'})`);
      });
      frag.appendChild(node);
    });
    els.results.appendChild(frag);
  }

  function renderPagination() {
    const total = state.filtered.length;
    const pages = Math.max(1, Math.ceil(total / state.pageSize));
    state.page = Math.min(state.page, pages);

    els.pagination.innerHTML = '';
    function mkBtn(label, disabled, onClick, ariaLabel) {
      const b = document.createElement('button');
      b.type = 'button';
      b.textContent = label;
      b.className = `px-3 py-2 rounded-lg border text-sm ${disabled? 'text-gray-400 border-gray-200 cursor-not-allowed' : 'border-gray-300 hover:bg-gray-100'}`;
      if (ariaLabel) b.setAttribute('aria-label', ariaLabel);
      b.disabled = disabled;
      if (!disabled) b.addEventListener('click', onClick);
      return b;
    }

    // Prev
    els.pagination.appendChild(mkBtn('‚Äπ', state.page === 1, () => { state.page--; writeURLState(); render(); }, 'P√°gina anterior'));

    // N√∫meros (faixa din√¢mica)
    const windowSize = 5;
    const start = Math.max(1, state.page - Math.floor(windowSize/2));
    const end = Math.min(pages, start + windowSize - 1);
    for (let p = start; p <= end; p++) {
      const b = mkBtn(String(p), false, () => { state.page = p; writeURLState(); render(); });
      if (p === state.page) b.className = 'px-3 py-2 rounded-lg border text-sm bg-blue-600 text-white border-blue-600';
      els.pagination.appendChild(b);
    }

    // Next
    els.pagination.appendChild(mkBtn('‚Ä∫', state.page === pages, () => { state.page++; writeURLState(); render(); }, 'Pr√≥xima p√°gina'));
  }

  function render() {
    renderCounts();
    renderResults();
    renderPagination();
  }

  // Popular combobox de marcas
  function fillBrands() {
    const brands = Array.from(new Set(state.data.map(p => p.brand))).sort();
    els.brand.innerHTML = '<option value="">Todas</option>' + brands.map(b => `<option>${b}</option>`).join('');
    if (state.brand && brands.includes(state.brand)) {
      els.brand.value = state.brand;
    }
  }

  async function loadData() {
    // Tenta carregar /data/products.json. Se n√£o existir, usa SAMPLE_DATA
    try {
      const res = await fetch('./data/products.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('not ok');
      const json = await res.json();
      if (!Array.isArray(json)) throw new Error('invalid');
      state.data = json;
    } catch (e) {
      console.warn('Usando SAMPLE_DATA local (crie /data/products.json para dados reais).');
      state.data = SAMPLE_DATA;
    }
    // Ordena√ß√£o b√°sica
    state.data.sort((a,b)=> (a.brand||'').localeCompare(b.brand||'') || (a.title||'').localeCompare(b.title||''));
    fillBrands();
    applyFilters();
  }

  // Eventos
  els.q.addEventListener('input', debounce(() => { state.q = els.q.value.trim(); state.page = 1; writeURLState(); applyFilters(); }, 250));
  els.brand.addEventListener('change', () => { state.brand = els.brand.value; state.page = 1; writeURLState(); applyFilters(); });
  els.pageSize.addEventListener('change', () => { state.pageSize = parseInt(els.pageSize.value, 10); state.page = 1; writeURLState(); render(); });

  // Inicializa√ß√£o
  readURLState();
  loadData();
  </script>
</body>
</html>
